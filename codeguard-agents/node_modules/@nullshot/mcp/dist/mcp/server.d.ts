import { DurableObject } from 'cloudflare:workers';
import { McpServer } from '@modelcontextprotocol/sdk/server/mcp.js';
import { Implementation } from '@modelcontextprotocol/sdk/types.js';
import { IMcpServer } from './mcp-server-interface';
export declare const SSE_MESSAGE_ENDPOINT = "/sse/message";
export declare const WEBSOCKET_ENDPOINT = "/ws";
export declare const MCP_SUBPROTOCOL = "mcp";
/**
 * McpDurableServer is a Durable Object implementation of an MCP server.
 * It supports SSE connections for event streaming and WebSocket connections with hibernation.
 */
export declare abstract class McpServerDO<Env = unknown> extends DurableObject<Env> {
    private server;
    private sessions;
    protected ctx: DurableObjectState;
    constructor(ctx: DurableObjectState, env: any, server?: IMcpServer);
    /**
     * Returns the implementation information for the MCP server.
     * Must be implemented by subclasses.
     */
    abstract getImplementation(): Implementation;
    /**
     * Abstract method that must be implemented by subclasses to configure the server instance.
     * Called after server initialization to set up any additional server configuration, e.g., handlers of incoming RPC calls.
     * Note: This is only called when using a real McpServer, not when using a proxy
     */
    abstract configureServer(server: McpServer): void;
    protected processSSEConnection(request: Request): Response;
    /**
     * Process a WebSocket connection request
     */
    protected processWebSocketConnection(request: Request): Response;
    /**
     * Handle WebSocket messages
     * This is called by the Durable Object runtime when a message is received
     */
    webSocketMessage(ws: WebSocket, data: string | ArrayBuffer): Promise<void>;
    /**
     * Handle WebSocket close events
     */
    webSocketClose(ws: WebSocket, code: number, reason: string, wasClean: boolean): Promise<void>;
    /**
     * Handle WebSocket errors
     */
    webSocketError(ws: WebSocket, error: unknown): Promise<void>;
    /**
     * Find the WebSocketTransport associated with a specific WebSocket instance
     */
    private findWebSocketTransport;
    protected processMcpRequest(request: Request): Response | Promise<Response>;
    /**
     * Main fetch handler
     */
    fetch(request: Request): Promise<Response>;
}
